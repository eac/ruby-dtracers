#!/usr/bin/env ruby

output  = ARGV[0]
grapher = ENV['GRAPHER'] || `which flamegraph.pl`

if !output
  puts "Need to specify the output file generated by flamegraph.d"
end

if !grapher
  puts "Need to specify GRAPHER or make it available from PATH. e.g. GRAPHER=~/FlameGraph/flamegraph.pl"
  puts "Flamegraph generater can be downloaded at: git@github.com:brendangregg/FlameGraph.git"
  exit
end
grapher.chomp!

collapser = File.join(File.dirname(__FILE__), 'flame_collapse.rb')
name      = File.basename(output)
command   = "ruby #{collapser} #{output} | #{grapher} > #{name}.html"

puts "Running: #{command}"
system(command)

`open #{name}.html`
